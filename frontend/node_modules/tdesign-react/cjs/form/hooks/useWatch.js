/**
 * tdesign v1.15.8
 * (c) 2025 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var slicedToArray = require('../../_chunks/dep-5b506c2b.js');
var React = require('react');
var form_hooks_useForm = require('./useForm.js');
var _util_noop = require('../../_util/noop.js');
var get = require('../../_chunks/dep-4025eebb.js');
var isUndefined = require('../../_chunks/dep-22cab67c.js');
require('../../_chunks/dep-eb3fc11f.js');
require('../../_chunks/dep-ed1250a7.js');
require('../../_chunks/dep-5139f2bd.js');
require('../../_chunks/dep-978cf8f4.js');
require('../../_chunks/dep-6228dec3.js');
require('../../_chunks/dep-d85a1598.js');
require('../../_chunks/dep-6d194bab.js');
require('../../_chunks/dep-d9be3c5b.js');
require('../../_chunks/dep-67e7a4d7.js');
require('../../_chunks/dep-df62c753.js');
require('../../_chunks/dep-bbe36ea3.js');
require('../../_chunks/dep-2306061f.js');
require('../../_chunks/dep-45d27f3b.js');
require('../../_chunks/dep-b63856c7.js');
require('../../_chunks/dep-7d270a12.js');
require('../../_chunks/dep-f0acb1e5.js');
require('../../_chunks/dep-66cacecd.js');

function useWatch(name, form) {
  var _useState = React.useState(),
    _useState2 = slicedToArray._slicedToArray(_useState, 2),
    value = _useState2[0],
    setValue = _useState2[1];
  var valueStr = React.useMemo(function () {
    return JSON.stringify(value);
  }, [value]);
  var valueStrRef = React.useRef(valueStr);
  var isValidForm = form && form._init;
  React.useEffect(function () {
    var _form$getInternalHook3, _form$getFieldsValue2;
    if (!isValidForm) return;
    var _form$getInternalHook = (_form$getInternalHook3 = form.getInternalHooks) === null || _form$getInternalHook3 === void 0 ? void 0 : _form$getInternalHook3.call(form, form_hooks_useForm.HOOK_MARK),
      _form$getInternalHook2 = _form$getInternalHook.registerWatch,
      registerWatch = _form$getInternalHook2 === void 0 ? _util_noop["default"] : _form$getInternalHook2;
    var cancelRegister = registerWatch(function () {
      var _form$getFieldsValue;
      var allFieldsValue2 = (_form$getFieldsValue = form.getFieldsValue) === null || _form$getFieldsValue === void 0 ? void 0 : _form$getFieldsValue.call(form, true);
      var newValue = get.get(allFieldsValue2, name);
      var nextValueStr = JSON.stringify(newValue);
      if (valueStrRef.current !== nextValueStr) {
        valueStrRef.current = nextValueStr;
        setValue(nextValueStr);
      }
    });
    var allFieldsValue = (_form$getFieldsValue2 = form.getFieldsValue) === null || _form$getFieldsValue2 === void 0 ? void 0 : _form$getFieldsValue2.call(form, true);
    var initialValue = get.get(allFieldsValue, name);
    setValue(JSON.stringify(initialValue));
    return cancelRegister;
  }, []);
  return isUndefined.isUndefined(value) ? value : JSON.parse(value);
}

exports["default"] = useWatch;
//# sourceMappingURL=useWatch.js.map
